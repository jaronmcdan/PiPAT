# /etc/roi/roi.env (example)
#
# This file is OPTIONAL.
# - The code has sane defaults in config.py
# - Any value here overrides config.py via environment variables
# - The systemd unit loads this file automatically

# --- CAN ---
CAN_CHANNEL=can1
CAN_BITRATE=250000
# Set to 0 if you bring up SocketCAN elsewhere (e.g. /etc/network/interfaces)
CAN_SETUP=1

# Outgoing readback publish rate (ms). Set <=0 to disable TX scheduling.
CAN_TX_ENABLE=1
CAN_TX_PERIOD_MS=50

# --- Serial multimeter ---
MULTI_METER_PATH=/dev/ttyUSB0
MULTI_METER_BAUD=38400

# --- VISA ---
ELOAD_VISA_ID=USB0::11975::34816::*::0::INSTR
AFG_VISA_ID=ASRL/dev/ttyACM0::INSTR

# --- GPIO / K1 relay drive ---
K1_PIN_BCM=26
# 1 => active-low relay boards (GPIO LOW energizes coil)
K1_ACTIVE_LOW=0
# Invert CAN bit0 before driving K1 (optional)
K1_CAN_INVERT=0
# Idle K1 drive on timeout/startup
K1_IDLE_DRIVE=0

# --- Control watchdog (seconds) ---
CONTROL_TIMEOUT_SEC=2.0
K1_TIMEOUT_SEC=2.0
ELOAD_TIMEOUT_SEC=2.0
AFG_TIMEOUT_SEC=2.0
MMETER_TIMEOUT_SEC=2.0

# If True, apply idle states immediately on startup before processing controls.
APPLY_IDLE_ON_STARTUP=1

# --- Idle behavior ---
# E-load idle means input OFF by default (safety)
ELOAD_IDLE_INPUT_ON=0
ELOAD_IDLE_SHORT_ON=0

# AFG idle means output OFF by default (safety)
AFG_IDLE_OUTPUT_ON=0

# --- Dashboard / polling ---
# Rich TUI render rate (frames/sec). Does not affect CAN.
DASH_FPS=15
# Instrument polling cadence (seconds)
MEAS_POLL_PERIOD=0.2
STATUS_POLL_PERIOD=1.0

# Optional multimeter serial timeouts (seconds)
MULTI_METER_TIMEOUT=1.0
MULTI_METER_WRITE_TIMEOUT=1.0

# CAN bus load estimator (dashboard)
CAN_BUS_LOAD_ENABLE=1
CAN_BUS_LOAD_WINDOW_SEC=1.0
CAN_BUS_LOAD_STUFFING_FACTOR=1.2
CAN_BUS_LOAD_OVERHEAD_BITS=48

# --- MrSignal / LANYI MR2.0 (Modbus RTU over USB serial) ---
MRSIGNAL_ENABLE=1
# Default /dev/ttyUSB1 to avoid colliding with the multimeter default.
MRSIGNAL_PORT=/dev/ttyUSB1
MRSIGNAL_BAUD=9600
MRSIGNAL_SLAVE_ID=1
MRSIGNAL_PARITY=N
MRSIGNAL_STOPBITS=1
MRSIGNAL_TIMEOUT=0.5

# Optional float byteorder overrides (only if reads/writes look wrong)
# MRSIGNAL_FLOAT_BYTEORDER=BYTEORDER_BIG_SWAP
MRSIGNAL_FLOAT_BYTEORDER_AUTO=1

# Safety clamps
MRSIGNAL_MAX_V=24.0
MRSIGNAL_MAX_MA=24.0

# Watchdog timeout (defaults to CONTROL_TIMEOUT_SEC)
MRSIGNAL_TIMEOUT_SEC=2.0
